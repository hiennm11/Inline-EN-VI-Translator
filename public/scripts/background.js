chrome.runtime.onInstalled.addListener(async()=>{await e()});chrome.action.onClicked.addListener(async a=>{await e(a)});async function e(a){chrome.storage.sync.get("translator_on",async t=>{const n=!(t.translator_on||!1);chrome.storage.sync.set({translator_on:n}),chrome.action.setBadgeText({text:n?"ON":"OFF",tabId:a?.id}),n&&(await o("en"),await o("vi")),a?.id&&chrome.tabs.sendMessage(a.id,{action:"toggleTranslator",enabled:n})})}async function o(a="en"){if(!("Translator"in self))throw new Error("Translator is not supported.");const t=a==="en"?"vi":"en";if(await self.Translator.availability({sourceLanguage:a,targetLanguage:t})==="unavailable"){console.log(`${a} - ${t} pair is not supported.`);return}await self.Translator.create({sourceLanguage:a,targetLanguage:t,monitor(s){s.addEventListener("downloadprogress",r=>{console.log(`Downloaded ${a} - ${t}: ${r.loaded*100}%`)})}})}
